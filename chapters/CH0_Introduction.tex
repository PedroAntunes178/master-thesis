\chapter{Introduction}
\label{chapter:introduction}
This chapter talks about what motivates the development of this thesis project and refers to the project's objectives and results delivered. Furthermore, the chapter also covers which hardware and software components the author had to develop to achieve the thesis goal. Lastly, the author will explain the overall composition of this thesis report.

\section{Motivation}
\label{section:motivation}
The availability of fully open-source systems capable of executing an \acrfull{os} is limited. For a long time, the Linux kernel~\cite{torvalds1997linux} and the open-source software built around it allowed developers to implement a fully open-source Linux \acrshort{os} on their closed-source hardware devices. However, the scarcity of open-source hardware complicated the development of fully open-source systems. With the appearance of \textit{RISC-V}~\cite{asanovic2014instruction}, open-source hardware availability started growing. Developing a \textit{RISC-V} \acrfull{soc} capable of executing a Linux \acrshort{os} would allow researchers access a fully open-source system executing an \acrshort{os}. Having a Linux \acrshort{os} running in an \acrshort{soc} would allow developers to create new applications to run in that \acrshort{soc} without worrying about its hardware components. The Linux community is significant, and researchers are used to working with the Linux kernel. Therefore, the requirement for an \acrshort{soc} capable of running Linux is high.

A Linux \acrshort{os} allows using many features unavailable in bare-metal applications. When developers create a bare-metal application, they must be aware of the \acrshort{soc} hardware and are limited in terms of functionalities. Similarly, if developers were to create an application using \acrfull{rtos}, for example, freeRTOS~\cite{barry2008freertos}, they would have access to features such as a scheduler, events, threads, semaphores and message boxes. However, a Linux \acrshort{os} provides those and more functionalities. A Linux \acrshort{os} implements memory management and protection mechanisms, allows the execution of multiple applications simultaneously, supports multiple network adapters, and can interact with the user through a terminal. A Linux \acrshort{os} is also more secure than bare-metal or RTOS applications since it limits the user application's access to the machine resources, preventing misuse or damage.

What most motivates the development of a \textit{RISC-V} \acrshort{soc} capable of running a Linux \acrshort{os} is its advantages for future development. Such as creating hardware accelerators which work with a Linux \acrshort{os} and integrating them with the \acrshort{soc} the author developed to test in a real-world application.

\section{Objectives and Deliverables}
\label{section:objectives}
This dissertation work aims to develop an open-source \acrshort{soc} and execute a minimal Linux \acrshort{os} on it. The author will adapt the existing \textit{IOb-SoC}~\cite{iob_soc} to create an \acrshort{soc} that supports a Linux \acrshort{os}. \textit{IOb-SoC} is a modular open-source \textit{RISC-V} \acrshort{soc} that allows researchers to develop their own \acrshort{soc}. The \textit{IObundle} developers use \textit{Verilog}~\cite{thomas2008verilog} to describe \textit{IOb-SoC} and peripherals hardware.

The author had first to swap the current \acrshort{cpu} used in \textit{IOb-SoC}. The problem with the current \acrshort{cpu} is that it cannot run an \acrshort{os}, only bare-metal applications. Therefore, \textit{IOb-SoC-Linux} contains a 32-bit \textit{RISC-V} \acrshort{cpu} capable of running Linux. Then, since the \textit{IOb-SoC} does not support interrupts, the author had to create and integrate into \textit{IOb-SoC-Linux} the hardware needed to generate interrupts in a \textit{RISC-V} \acrshort{soc}. Lastly, the author had to ensure the Linux \acrshort{os} supported the \acrshort{uart} used in the \textit{IOb-SoC-Linux}. Since Linux does not support the \textit{IOb-SoC} \acrshort{uart}, the author integrated a \textit{UART16550} in \textit{IOb-SoC-Linux}.

Four major software components comprise a Linux \acrshort{os}. Those software components are the Linux kernel, the bootloader firmware, the \acrfull{rootfs} and a \acrfull{dtb}. The author had to build those software components to run a Linux \acrshort{os} on the \textit{IOb-SoC-Linux}. On power-on, the \textit{IOb-SoC-Linux} transfers the Linux \acrshort{os} software binary files onto the board where it runs, and the Linux \acrshort{os} will boot. After the \acrshort{os} boots, the user can run custom applications and take advantage of the Linux \acrshort{os}. The author also automated and documented the process of generating and deploying the Linux image to \textit{IOb-SoC-Linux} so that, after this work, creating new images with different characteristics will be straightforward.

Finally, the system must be fully verified both on simulation and running on an \acrshort{fpga} board. The \textit{IOb-SoC} needed a fast \textit{Verilog} simulator to verify the Linux OS execution. Therefore, the author developed a simulation testbench using the free-of-charge and open-source \textit{Verilator}~\cite{snyder2010verilator} simulator.

\section{Author's Work}
\label{section:authors_work}
The author had to develop four hardware modules to develop a \acrfull{soc} capable of executing a Linux \acrshort{os}. Those hardware modules allowed the integration of a new \acrshort{cpu}, a new \acrshort{uart} and the hardware needed to support interrupts in the \textit{IOb-SoC}. Besides integrating new hardware in the \textit{IOb-SoC}, the author made minor changes to the \textit{IOb-SoC} core. The new \acrshort{cpu} used generates from the \textit{SpinalHDL}~\cite{papon2017spinalhdl} \textit{VexRiscv}~\cite{vexriscv} platform. The \textit{VexRiscv} platform allowed the author to generate a \textit{VexRiscv} \acrshort{cpu} core that meets the requirements to execute an \acrlong{os}. Furthermore, the author still had to create a \acrshort{cpu} wrapper to adapt the \textit{VexRiscv} \acrshort{cpu} to the \textit{IOb-SoC}. Another hardware component the author had to develop was a wrapper for a \acrshort{uart} compatible with Linux. The author adapted the wishbone interface of an industry-standard \textit{UART16550} to the \textit{IOb-SoC}. Additionally, the author fully developed the \acrshort{clint} hardware. The \acrshort{clint} is a hardware component that generates timer and software-related interrupts for a \textit{RISC-V} system. Another hardware component which manages interrupts generated by other peripherals in a \textit{RISC-V} system is the \acrshort{plic}. The author adapted an existing \acrshort{plic} module to the system by creating an interface that worked with \textit{IOb-SoC}.

During this thesis, the author also developed many software components. Those software components were essential to run a Linux \acrshort{os} in \textit{IOb-SoC} or enhance the \textit{IOb-SoC} platform. First, the author translated a program written in \textit{C} programming language, called \textit{Console}, to \textit{Python}. The \textit{IOb-SoC} platform uses the \textit{Console} program to communicate through Serial with the board. Furthermore, the author added features to the \textit{Console} that made it capable of working with the simulator testbench and communicating with a Linux \acrshort{os} running in \textit{IOb-SoC}. Secondly, the author developed a new simulation testbench, based on the previous \textit{IOb-SoC} verification software, capable of communicating with the \textit{Console} program. Moreover, the author integrated the \textit{Verilator}~\cite{snyder2010verilator} simulation software in \textit{IOb-SoC} and created a \textit{Verilator} \textit{C++} testbench. Thirdly, the author created a simulation testbench for the \acrshort{clint} hardware and an interrupt routine firmware that took advantage of the \acrshort{clint}. The firmware created demonstrates how to use interrupts in \textit{IOb-SoC}. Finally, the author adapted, built and deployed the software needed to execute a Linux \acrshort{os} in the \acrshort{soc}. The author had to adapt the \textit{IOb-SoC} bootloader firmware. He created a device tree file describing the hardware components of the \acrshort{soc}. He compiled a Linux kernel version compatible with the \textit{VexRiscv} \acrshort{cpu} and developed a \acrshort{rootfs} adequate for a minimal Linux \acrshort{os}. While developing the hardware and software components, the author also developed Makefile scripts that help integrate the components in \textit{IOb-SoC} and automatise the building and deployment process.

%Therefore, the author created a \acrshort{soc} capable of executing a Linux \acrshort{os} by changing the \textit{IOb-SoC} \acrshort{cpu} and adding three hardware peripherals. Additionally, the author developed software that improved the \textit{IOb-SoC} platform, complemented the hardware components created and allowed to execute a complete \acrlong{os} in the new \acrshort{soc}. The \acrshort{soc} developed might also be referred as \textit{IOb-SoC-Linux}. % USED IN ABSTRACT.

\section{Thesis Outline}
\label{section:thesis_outline}
This thesis has five significant chapters. Chapters \ref{chapter:must_have_concepts} and \ref{chapter:existing_embedded_technologies} address the theme's state-of-the-art. Chapters \ref{chapter:hardware_developed} and \ref{chapter:software_developed} discuss the components the author developed to achieve the thesis goal, and chapter \ref{chapter:project_results} shows the results. The thesis's first chapter (i.e. this chapter) is an introduction to the thesis, and the last chapter (\ref{chapter:conclusions}) is the author's conclusions after completing the project.

In chapter \ref{chapter:must_have_concepts}, the author discusses the tools, concepts and standards the reader must understand to comprehend the following chapters and the decisions the author made while developing the thesis project. Chapter \ref{chapter:existing_embedded_technologies} presents the existing technologies capable of executing a full feature \acrlong{os} and discusses the possibility of integrating them in \textit{IOb-SoC}. The author described the hardware he had to develop to successfully create an \acrshort{soc} capable of executing a Linux \acrshort{os} in chapter \ref{chapter:hardware_developed}. Chapter \ref{chapter:software_developed} presents the software components the author had to develop. The software presented in chapter \ref{chapter:software_developed} is not only needed to execute the Linux \acrshort{os} in the developed \acrshort{soc} but also improves the \textit{IOb-SoC} platform and tests the hardware the author developed.

Finally, chapter \ref{chapter:project_results} shows the products of this expedition. The author achieved many breakthroughs in various steps of this thesis development. For every breakthrough, the author obtained results that allowed analysing and discussing the hardware and software developed up until then.
