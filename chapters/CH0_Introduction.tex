\chapter{Introduction}
\label{chapter:introduction}
This chapter discusses the motivation for developing this thesis project, the project's objectives and the results delivered. Furthermore, the chapter also covers hardware and software components designed to achieve the thesis goal. Lastly, the author explains the overall composition of this thesis report.

\section{Motivation}
\label{section:motivation}
The availability of fully open-source systems capable of executing an \acrfull{os} is limited. For a long time, the Linux kernel~\cite{torvalds1997linux} and the open-source software built around it allowed developers to implement a fully open-source Linux \acrshort{os} on their closed-source hardware devices. However, the lack of open-source hardware makes it difficult to develop fully open-source systems. With the appearance of \textit{RISC-V}~\cite{asanovic2014instruction}, open-source hardware availability started growing. Developing a \textit{RISC-V} \acrfull{soc} capable of running a Linux \acrshort{os} allows researchers to execute an \acrshort{os} in a fully open-source system. Having a Linux \acrshort{os} running in an \acrshort{soc} enables developers to create new applications for that \acrshort{soc} without worrying about its hardware components. The Linux community is significant, and researchers are used to working with the Linux kernel. Therefore, the requirement for an \acrshort{soc} capable of running Linux is high.

A Linux \acrshort{os} allows using many features unavailable in bare-metal applications. When developers create a bare-metal application, they are limited on software functionalities and must be aware of the \acrshort{soc} hardware characteristics. Similarly, if developers were to build an application using \acrfull{rtos}, for example, \textit{freeRTOS}~\cite{barry2008freertos}, they would only have access to features such as a scheduler, events, threads, semaphores and message boxes. A Linux \acrshort{os} provides those and more functionalities. A Linux \acrshort{os} implements memory management and protection mechanisms, allows the execution of multiple applications simultaneously, supports various network adapters, and can interact with the user through a terminal. A Linux \acrshort{os} is also more secure than bare-metal or \acrshort{rtos} applications since it limits the user application's access to the machine resources, preventing misuse or damage.

The development of a \textit{RISC-V} \acrshort{soc} capable of running a Linux \acrshort{os} allows future open-source developments. Such as producing hardware accelerators which work with a Linux \acrshort{os} and integrating them with \textit{IOb-SoC-Linux}. These, and the possibilities to test in a real-world application, were the main reasons and motivations for developing this thesis.

\section{Objectives and Deliverables}
\label{section:objectives}
This study aims to develop an open-source \acrshort{soc} and execute a minimal Linux \acrshort{os}. The \acrshort{soc} developed must derive from the existing \textit{IOb-SoC}~\cite{iob_soc}. \textit{IOb-SoC} is a modular open-source \textit{RISC-V} \acrshort{soc} that allows researchers to develop their own \acrshort{soc}. The \textit{IObundle} developers use \textit{Verilog}~\cite{thomas2008verilog} to describe \textit{IOb-SoC} and its peripheral's hardware.

An \acrshort{soc} compatible with a Linux \acrshort{os} must contain a compatible \acrshort{cpu}, support for interrupts and an appropriate \acrshort{uart}. The \textit{IOb-SoC} \acrshort{cpu} has a problem: it cannot run an \acrshort{os}, only bare-metal applications. Therefore, \textit{IOb-SoC-Linux} contains a 32-bit \textit{RISC-V} \acrshort{cpu} capable of running Linux. Since the \textit{IOb-SoC} does not support interrupts, \textit{IOb-SoC-Linux} requires the integration of the respective hardware created for that purpose. Lastly, the Linux kernel does have drivers for the \textit{IOb-SoC} \acrshort{uart}. Consequently, \textit{IOb-SoC-Linux} must incorporate an industry-standard \textit{UART16550}.

Four major software components make up a Linux \acrshort{os}. Those software components are the Linux kernel, the bootloader firmware, the \acrfull{rootfs} and a \acrfull{dtb}. On power-on, the \textit{IOb-SoC-Linux} transfers the Linux \acrshort{os} software binary files onto the board where it runs, and the Linux \acrshort{os} will boot. After the \acrshort{os} boots, the user can run custom applications and take advantage of the Linux \acrshort{os}. The process of generating and deploying the Linux \acrshort{os} to \textit{IOb-SoC-Linux} has to be automated and documented. So, after this work, creating new \acrshort{os}s with different characteristics will be straightforward.

Finally, the system is verified both on simulation and running on an \acrshort{fpga} board. \textit{IOb-SoC} needs a fast \textit{Verilog} simulator to verify the Linux \acrshort{os} execution. Therefore, the project must develop a simulation testbench using the free-of-charge and open-source \textit{Verilator}~\cite{snyder2010verilator} simulator.

\section{Author's Work}
\label{section:authors_work}
The author had to develop four hardware modules to build a \acrfull{soc} capable of executing a Linux \acrshort{os}. Those hardware modules allowed the integration of a new \acrshort{cpu}, a new \acrshort{uart} and the hardware needed to support interrupts in the \textit{IOb-SoC}. Besides integrating new hardware in the \textit{IOb-SoC}, minor changes to the \textit{IOb-SoC} core were made. The newly used \acrshort{cpu} core was generated based on the \textit{SpinalHDL}~\cite{papon2017spinalhdl} \textit{VexRiscv}~\cite{vexriscv} platform. The \textit{VexRiscv} platform enabled the development of a \textit{VexRiscv} \acrshort{cpu} core that meets the requirements of an \acrshort{os}. The \textit{VexRiscv} \acrshort{cpu} still needed a \acrshort{cpu} wrapper to integrate with the \textit{IOb-SoC} interface. The Linux \acrshort{os} also requires a compatible \acrshort{uart} to communicate with the user. Linux has drivers that support an existing \textit{UART16550}. A hardware wrapper allows the integration of the \textit{UART16550} on \textit{IOb-SoC-Linux}. Additionally, the \acrshort{soc} has to support timer and software interrupts to run an \acrshort{os}. The \acrshort{clint} hardware module developed generates timer and software-related interrupts for a \textit{RISC-V} system. Another hardware component which manages interrupts in a \textit{RISC-V} system is the \acrshort{plic}. A developed hardware component creates an interface with the \textit{IOb-SoC} and instantiates an existing \acrshort{plic} core and register modules enabling external interrupts on \textit{IOb-SoC-Linux}.

During this thesis, the author also developed many software components. Those software components were essential to run a Linux \acrshort{os} in \textit{IOb-SoC} or enhance the \textit{IOb-SoC} platform. First, the new \textit{Console} program written in \textit{Python} allows the \textit{IOb-SoC} platform to communicate through serial with the board. Previously, the \textit{Console} program was written in \textit{C} and had fewer features than the new \textit{Console}. The new \textit{Console} can work with the simulator testbench and communicate with a Linux \acrshort{os} running in \textit{IOb-SoC-Linux}. Secondly, based on the previous \textit{IOb-SoC} verification software, a new hardware simulation testbench can test the \acrshort{soc} and communicate with the \textit{Console} program. Moreover, the \textit{Verilator}~\cite{snyder2010verilator} simulation software allowed the creation of a \textit{Verilator} \textit{C++} testbench to test the \acrshort{soc} faster. Thirdly, a hardware simulation testbench created for the \acrshort{clint} verifies its behaviour, and a bare-metal interrupt routine firmware developed shows how to use interrupts in \textit{IOb-SoC-Linux}. Finally, the author adapted, built and deployed the software needed to execute a Linux \acrshort{os} in the \acrshort{soc}. The adapted \textit{IOb-SoC} bootloader firmware allows loading the software to the \textit{IOb-SoC-VexRiscv} memory. A device tree file describes the hardware components of the \acrshort{soc} to the Linux kernel. The compiled Linux kernel version must be compatible with the \textit{VexRiscv} \acrshort{cpu}, and the root file system developed must be adequate for a minimal Linux \acrshort{os}. While developing the hardware and software components, Makefile scripts helped integrate the components in \textit{IOb-SoC} and automatise the building and deployment process.

\section{Thesis Outline}
\label{section:thesis_outline}
This thesis has five significant chapters. Chapters \ref{chapter:must_have_concepts} and \ref{chapter:existing_embedded_technologies} address the state-of-the-art. Chapters \ref{chapter:hardware_developed} and \ref{chapter:software_developed} discuss the authors' developments to achieve the thesis goal, and chapter \ref{chapter:project_results} shows the results.

The first chapter introduces the thesis. Chapter \ref{chapter:must_have_concepts} discusses the tools, concepts and standards the reader must understand to comprehend the following chapters and the design decisions while developing the project. Chapter \ref{chapter:existing_embedded_technologies} presents the existing technologies capable of executing a full-feature \acrshort{os} and discusses the possibility of integrating them in \textit{IOb-SoC}. Chapter \ref{chapter:hardware_developed} describes the hardware developed to successfully create an \acrshort{soc} capable of executing a Linux \acrshort{os}. Chapter \ref{chapter:software_developed} presents the software components this work created. The software is required to run the Linux \acrshort{os} in the developed \acrshort{soc}, improve the \textit{IOb-SoC} platform, and test the hardware. Finally, chapter \ref{chapter:project_results} shows the products of this expedition. This work achieves many breakthroughs along the way. For each breakthrough, one presents hardware and software analysis results and respective discussions. The last chapter (\ref{chapter:conclusions}) mentions the conclusions after completing the project.
